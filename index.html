<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reflectify - Track & Reflect</title>
  <!-- 1. Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
  <!-- 2. Chart.js untuk Grafik --><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- 3. Ikon (Heroicons) --><script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
  <style>
    @import url('https://rsms.me/inter/inter.css');

    html {
      font-family: 'Inter', sans-serif;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    ::-webkit-scrollbar-thumb {
      background: #c5c5c5;
      border-radius: 6px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }
    
    /* Style untuk Notifikasi Toast */
    #toast-notification {
      transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
      opacity: 0;
      pointer-events: none; 
      z-index: 1000; 
    }
    
    /* Default: Untuk mobile (tengah bawah) */
    #toast-notification {
        bottom: 80px; /* Naik di atas nav bawah */
        left: 50%;
        transform: translate(-50%, 100px); 
    }
    #toast-notification.show {
        transform: translate(-50%, 0); 
        opacity: 1;
    }
    
    /* Untuk desktop (kanan atas) */
    @media (min-width: 768px) { /* md */
        #toast-notification {
            top: 20px;
            right: 20px;
            left: auto; 
            bottom: auto; 
            transform: translate(100%, 0); 
        }
        #toast-notification.show {
            transform: translate(0, 0); 
            opacity: 1;
        }
    }

    /* Style untuk item yang bisa diklik */
    .activity-item, .journal-item {
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .activity-item:hover, .journal-item:hover {
      background-color: #f9fafb; 
    }
    
    /* Style Untuk Sidebar Minimize */
    #sidebar {
      transition: width 0.3s ease-in-out;
    }
    #main-content {
      transition: margin-left 0.3s ease-in-out;
    }
    
    .sidebar-collapsed #sidebar {
      width: 80px; 
    }
    .sidebar-collapsed #sidebar #logo-text,
    .sidebar-collapsed #sidebar .nav-text,
    .sidebar-collapsed #sidebar #user-info-box {
      display: none; 
    }
    .sidebar-collapsed #sidebar .nav-link {
      justify-content: center; 
    }
    .sidebar-collapsed #sidebar #logo-icon {
      display: block; 
      margin: 0 auto;
    }
    .sidebar-collapsed #main-content {
      margin-left: 80px; 
    }
    /* #desktop-footer sudah dihapus, jadi tidak perlu lagi mengaturnya */
    
    .nav-link-mobile.active-tab-mobile {
      color: #4338CA; 
    }
    
    /* Navigasi Sidebar Desktop */
    .nav-link {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 12px 16px;
      font-size: 1rem;
      font-weight: 500;
      border-radius: 8px;
      transition: all 0.2s ease-in-out;
      color: #4B5563;
    }
    .nav-link:hover {
      background-color: #F9FAFB;
      color: #1F2937;
    }
    .nav-link.active-tab {
      background-color: #EEF2FF;
      color: #4338CA;
      font-weight: 600;
    }
    
    /* Navigasi Mobile */
    .nav-link-mobile {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex-grow: 1;
      padding-top: 8px;
      padding-bottom: 8px;
      font-weight: 500;
      color: #6B7280; 
      transition: all 0.2s ease-in-out;
    }
    
  </style>
</head>

<body class="bg-gray-50 text-gray-800">

  <!-- Notifikasi Toast --><div id="toast-notification" class="fixed px-6 py-3 rounded-lg shadow-lg">
    Tersimpan!
  </div>
  
  <!-- Halaman Autentikasi --><div id="auth-page" class="flex items-center justify-center min-h-screen bg-gray-100 p-4">
    <div class="w-full max-w-md bg-white p-8 rounded-xl shadow-2xl">
      <h2 class="text-3xl font-bold text-center text-indigo-600 mb-8">Selamat Datang di Reflectify</h2>
      
      <div class="space-y-4">
        <div>
          <label for="auth-email" class="block text-sm font-medium text-gray-700">Email</label>
          <input type="email" id="auth-email" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        <div>
          <label for="auth-password" class="block text-sm font-medium text-gray-700">Password</label>
          <input type="password" id="auth-password" class="mt-1 block w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
        </div>
        
        <p id="auth-error" class="text-sm text-red-600" style="display: none;"></p>
        
        <div class="flex flex-col sm:flex-row gap-4">
          <button id="login-btn" class="w-full flex-1 bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-indigo-700 transition-colors shadow-md">
            Login
          </button>
          <button id="register-btn" class="w-full flex-1 bg-white text-indigo-600 border border-indigo-500 px-6 py-3 rounded-lg font-medium hover:bg-indigo-50 transition-colors">
            Register
          </button>
        </div>
      </div>
      
      <p class="text-xs text-gray-500 mt-6 text-center">
        Data Anda akan aman tersimpan di akun Anda.
      </p>
    </div>
  </div>

  <!-- Halaman Aplikasi Utama --><div id="app-page" class="flex-col md:flex-row min-h-screen" style="display: none;">

    <!-- Header Mobile --><header class="md:hidden sticky top-0 bg-white shadow-md p-4 flex justify-between items-center z-20"> 
      <h1 class="text-2xl font-bold text-indigo-600">Reflectify</h1>
      <div class="relative">
        <button id="profile-icon-btn">
          <ion-icon name="person-circle-outline" class="text-3xl text-gray-600"></ion-icon>
        </button>
        <!-- Profile Dropdown --><div id="profile-dropdown" class="absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl overflow-hidden" style="display: none;">
          <div class="p-4 border-b">
            <p class="text-sm font-medium text-gray-900">Signed in as</p>
            <p id="user-email-mobile" class="text-sm text-gray-500 truncate">...</p>
          </div>
          <button id="logout-btn-mobile" class="w-full text-left px-4 py-3 text-sm text-red-600 hover:bg-red-50 flex items-center">
            <ion-icon name="log-out-outline" class="mr-2"></ion-icon>
            Logout
          </button>
        </div>
      </div>
    </header>

    <!-- Sidebar --><aside id="sidebar" class="hidden md:flex md:w-64 bg-white shadow-lg p-6 flex-col fixed top-0 left-0 h-full z-20"> 
      <div class="flex items-center mb-10">
        <span id="logo-text" class="text-3xl font-bold text-indigo-600">Reflectify</span>
        <span id="logo-icon" class="text-3xl font-bold text-indigo-600 hidden">
          <ion-icon name="analytics-outline"></ion-icon>
        </span>
      </div>
      <nav class="flex-grow">
        <ul class="space-y-3">
          <li><button onclick="showTab('tracker')" class="nav-link tab-button nav-sidebar active-tab group"
              data-tab="tracker"><ion-icon name="checkbox-outline" class="mr-3 nav-icon"></ion-icon><span class="nav-text">Tracker Harian</span></button></li>
          <li><button onclick="showTab('journal')" class="nav-link tab-button nav-sidebar group"
              data-tab="journal"><ion-icon name="book-outline" class="mr-3 nav-icon"></ion-icon><span class="nav-text">Insight Journal</span></button></li>
          <li><button onclick="showTab('dashboard')" class="nav-link tab-button nav-sidebar group"
              data-tab="dashboard"><ion-icon name="stats-chart-outline" class="mr-3 nav-icon"></ion-icon><span class="nav-text">Growth Dashboard</span></button></li>
          <li><button onclick="showTab('prompt')" class="nav-link tab-button nav-sidebar group"
              data-tab="prompt"><ion-icon name="sparkles-outline" class="mr-3 nav-icon"></ion-icon><span class="nav-text">Daily Prompt</span></button></li>
          <li><button onclick="showTab('ai')" class="nav-link tab-button nav-sidebar group" data-tab="ai"><ion-icon
                name="chatbubble-ellipses-outline" class="mr-3 nav-icon"></ion-icon><span class="nav-text">AI Companion</span></button></li>
        </ul>
      </nav>
      <!-- Info User & Tombol Logout --><div id="user-info-box" class="mt-6 border-t pt-4">
         <p class="text-xs text-gray-400 truncate">Email: <span id="user-email" class="text-gray-500">...</span></p>
         <p class="text-xs text-gray-400 truncate">UID: <span id="user-id" class="text-gray-500">...</span></p>
         <button id="logout-btn-desktop" class="mt-4 mb-6 w-full flex items-center justify-center text-sm bg-red-50 text-red-600 px-3 py-2 rounded-lg font-medium hover:bg-red-100 transition-colors">
            <ion-icon name="log-out-outline" class="mr-2"></ion-icon>
            <span class="nav-text">Logout</span> 
         </button>
         <p class="text-center text-xs text-gray-400 mt-4">© 2025 Reflectify by <span class="font-bold text-indigo-600">@JakiJeki</span></p>
      </div>
    </aside>

    <!-- Konten Utama --><main id="main-content" class="flex-1 md:ml-64 p-6 md:p-10 overflow-auto pb-24 md:pb-16">
      
      <!-- Tombol Hamburger Desktop --><button id="hamburger-btn" class="hidden md:block fixed top-6 right-6 z-30 p-2 bg-gray-200 rounded-md hover:bg-gray-300"> 
        <ion-icon name="menu-outline" class="text-2xl"></ion-icon>
      </button>

      <!-- === KONTEN 1: TRACKER HARIAN === --><div id="tracker" class="tab-content active">
        <h2 class="text-4xl font-bold mb-6">Tracker Harian</h2>
        <div class="bg-white p-6 rounded-xl shadow-lg">
          
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-semibold">Aktivitas Tercatat Hari Ini</h3>
            <button id="add-activity-btn" class="bg-indigo-600 text-white px-5 py-2 rounded-lg font-medium hover:bg-indigo-700 transition-colors shadow-md">Tambah Aktivitas</button>
          </div>
          
          <div id="activity-list" class="space-y-3">
            <p id="loading-activities" class="text-gray-500">Memuat aktivitas...</p>
          </div>
          
          <hr class="my-8 border-gray-200">

          <!-- Rating Harian --><div>
            <h3 class="text-2xl font-semibold mb-4">Rating Harian</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label for="mood-rating" class="block text-lg font-medium mb-2">Mood Hari Ini</label>
                <div id="mood-rating-stars" class="flex space-x-2 text-4xl text-gray-300 cursor-pointer">
                  <ion-icon name="star-outline" data-value="1"></ion-icon>
                  <ion-icon name="star-outline" data-value="2"></ion-icon>
                  <ion-icon name="star-outline" data-value="3"></ion-icon>
                  <ion-icon name="star-outline" data-value="4"></ion-icon>
                  <ion-icon name="star-outline" data-value="5"></ion-icon>
                </div>
              </div>
              <div>
                <label for="focus-rating" class="block text-lg font-medium mb-2">Fokus Hari Ini</label>
                <div id="focus-rating-stars" class="flex space-x-2 text-4xl text-gray-300 cursor-pointer">
                  <ion-icon name="star-outline" data-value="1"></ion-icon>
                  <ion-icon name="star-outline" data-value="2"></ion-icon>
                  <ion-icon name="star-outline" data-value="3"></ion-icon>
                  <ion-icon name="star-outline" data-value="4"></ion-icon>
                  <ion-icon name="star-outline" data-value="5"></ion-icon>
                </div>
              </div>
            </div>
            <button id="save-rating-btn" class="mt-6 bg-green-600 text-white px-5 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors shadow-md">Simpan Rating</button>
          </div>
        </div>
      </div>

      <!-- === KONTEN 2: INSIGHT JOURNAL === --><div id="journal" class="tab-content">
        <h2 class="text-4xl font-bold mb-6">Insight Journal</h2>
        <div class="bg-white p-6 rounded-xl shadow-lg">
          <div class="mb-6">
            <label for="journal-category" class="block text-lg font-medium mb-2">Kategori Refleksi</label>
            <select id="journal-category" class="w-full md:w-1/3 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
              <option value="Mindset">Mindset</option>
              <option value="Emosi">Emosi</option>
              <option value="Spiritual">Spiritual</option>
              <option value="Sosial">Sosial</option>
              <option value="Skill">Skill</option>
            </select>
          </div>
          <div class="mb-6">
            <label for="journal-entry" class="block text-lg font-medium mb-2">Apa yang kamu pelajari hari ini?</label>
            <textarea id="journal-entry" rows="10" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Tuliskan refleksimu di sini..."></textarea>
          </div>
          <button id="save-journal-btn" class="bg-indigo-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-indigo-700 transition-colors shadow-md">Simpan Jurnal</button>
          
          <hr class="my-8 border-gray-200">
          <h3 class="text-2xl font-semibold mb-4">Jurnal Tersimpan</h3>
          <div id="journal-list" class="space-y-4">
             <p id="loading-journals" class="text-gray-500">Memuat jurnal...</p>
          </div>
        </div>
      </div>

      <!-- === KONTEN 3: GROWTH DASHBOARD === --><div id="dashboard" class="tab-content">
        <h2 class="text-4xl font-bold mb-6">Growth Dashboard</h2>
        <div class="bg-white p-6 rounded-xl shadow-lg">
          <h3 class="text-2xl font-semibold mb-4">Korelasi Mood & Fokus Mingguan</h3>
          <p class="text-gray-600 mb-6">Grafik ini menunjukkan hubungan antara mood dan fokus harian Anda selama 7 hari terakhir.</p>
          <div class="w-full h-96">
            <canvas id="moodFocusChart"></canvas>
          </div>
        </div>
      </div>

      <!-- === KONTEN 4: DAILY PROMPT === --><div id="prompt" class="tab-content">
        <h2 class="text-4xl font-bold mb-6">Daily Prompt</h2>
        <div class="bg-white p-8 rounded-xl shadow-lg text-center">
          <h3 id="prompt-question" class="text-3xl font-medium text-gray-700 mb-8">...</h3>
          <button id="new-prompt-btn" class="bg-white border border-indigo-600 text-indigo-600 px-5 py-2 rounded-lg font-medium hover:bg-indigo-50 transition-colors">Ganti Pertanyaan</button>
        </div>
      </div>

      <!-- === KONTEN 5: AI COMPANION === --><div id="ai" class="tab-content">
        <h2 class="text-4xl font-bold mb-6">AI Companion</h2>
        <div class="bg-white p-6 rounded-xl shadow-lg">
          <p class="text-gray-600 mb-6">Tanya guru batin mini Anda. Apa yang Anda rasakan? Apa yang membuat Anda bingung?</p>
          <div id="ai-chat-box" class="w-full h-96 bg-gray-50 border border-gray-200 rounded-lg p-4 overflow-y-auto mb-4 space-y-4">
            <div class="p-3 bg-indigo-100 rounded-lg self-start max-w-xs">
              <p class="text-sm text-indigo-800">Halo! Saya di sini untuk membantu Anda berefleksi. Apa yang ada di pikiran Anda?</p>
            </div>
          </div>
          <div class="flex">
            <input type="text" id="ai-input" class="flex-1 p-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Tulis pesanmu...">
            <button id="ai-send-btn" class="bg-indigo-600 text-white px-6 py-3 rounded-r-lg font-medium hover:bg-indigo-700 transition-colors shadow-md">Kirim</button>
          </div>
        </div>
      </div>

    </main>
    
    <!-- FOOTER DESKTOP DIHAPUS DARI SINI --></div>

  <!-- Navigasi Bawah untuk Mobile --><nav id="mobile-nav" class="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t border-gray-200 flex justify-around z-20"> 
    <button onclick="showTab('tracker')" class="nav-link-mobile tab-button nav-mobile active-tab-mobile group" data-tab="tracker">
      <ion-icon name="checkbox-outline" class="text-2xl"></ion-icon>
      <span class="text-xs">Tracker</span>
    </button>
    <button onclick="showTab('journal')" class="nav-link-mobile tab-button nav-mobile group" data-tab="journal">
      <ion-icon name="book-outline" class="text-2xl"></ion-icon>
      <span class="text-xs">Journal</span>
    </button>
    <button onclick="showTab('dashboard')" class="nav-link-mobile tab-button nav-mobile group" data-tab="dashboard">
      <ion-icon name="stats-chart-outline" class="text-2xl"></ion-icon>
      <span class="text-xs">Growth</span>
    </button>
    <button onclick="showTab('prompt')" class="nav-link-mobile tab-button nav-mobile group" data-tab="prompt">
      <ion-icon name="sparkles-outline" class="text-2xl"></ion-icon>
      <span class="text-xs">Prompt</span>
    </button>
    <button onclick="showTab('ai')" class="nav-link-mobile tab-button nav-mobile group" data-tab="ai">
      <ion-icon name="chatbubble-ellipses-outline" class="text-2xl"></ion-icon>
      <span class="text-xs">AI</span>
    </button>
  </nav>

  <!-- Modal untuk Tambah Aktivitas Baru --><div id="add-activity-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
    style="display: none;">
    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md">
      <h3 class="text-2xl font-semibold mb-6">Tambah Aktivitas Baru</h3>
      <div class="mb-4">
        <label for="activity-name" class="block text-lg font-medium mb-2">Nama Aktivitas</label>
        <input type="text" id="activity-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="Contoh: Olahraga 30 menit">
      </div>
      <div class="flex justify-end space-x-4">
        <button id="cancel-add-activity" class="bg-gray-200 text-gray-800 px-5 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors">Batal</button>
        <button id="save-new-activity" class="bg-indigo-600 text-white px-5 py-2 rounded-lg font-medium hover:bg-indigo-700 transition-colors">Simpan</button>
      </div>
    </div>
  </div>

  <!-- Modal Edit/Hapus --><div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
    style="display: none;">
    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md">
      <h3 id="edit-modal-title" class="text-2xl font-semibold mb-6">Edit Entri</h3>
      
      <input type="hidden" id="edit-doc-id">
      <input type="hidden" id="edit-collection-type">
      
      <div id="edit-activity-form" class="hidden space-y-4">
        <div>
          <label for="edit-activity-name" class="block text-lg font-medium mb-2">Nama Aktivitas</label>
          <input type="text" id="edit-activity-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
        </div>
      </div>
      
      <div id="edit-journal-form" class="hidden space-y-4">
        <div>
          <label for="edit-journal-category" class="block text-lg font-medium mb-2">Kategori</label>
          <select id="edit-journal-category" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
            <option value="Mindset">Mindset</option>
            <option value="Emosi">Emosi</option>
            <option value="Spiritual">Spiritual</option>
            <option value="Sosial">Sosial</option>
            <option value="Skill">Skill</option>
          </select>
        </div>
        <div>
          <label for="edit-journal-content" class="block text-lg font-medium mb-2">Konten Jurnal</label>
          <textarea id="edit-journal-content" rows="6" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"></textarea>
        </div>
      </div>
      
      <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mt-8 space-y-4 sm:space-y-0">
        <button id="delete-entry-btn" class="flex items-center justify-center w-full sm:w-auto bg-white text-red-600 border border-red-500 px-5 py-2 rounded-lg font-medium hover:bg-red-50 transition-colors">
          <ion-icon name="trash-outline" class="mr-2"></ion-icon>
          <span>Hapus</span>
        </button>
        
        <div class="flex flex-col-reverse sm:flex-row sm:space-x-4 space-y-4 space-y-reverse sm:space-y-0">
          <button id="cancel-edit-btn" class="w-full sm:w-auto bg-gray-200 text-gray-800 px-5 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors">Batal</button>
          <button id="save-changes-btn" class="w-full sm:w-auto bg-indigo-600 text-white px-5 py-2 rounded-lg font-medium hover:bg-indigo-700 transition-colors">Simpan Perubahan</button>
        </div>
      </div>
    </div>
  </div>


  <!-- ================================== --><!--      SKRIP UTAMA APLIKASI          --><!-- ================================== --><script type="module">
    // Impor fungsi auth yang baru
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      addDoc,
      collection,
      onSnapshot,
      query,
      Timestamp,
      where,
      writeBatch,
      getDocs,
      orderBy,
      updateDoc, 
      deleteDoc  
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // === VARIABEL GLOBAL APLIKASI ===
    let db, auth, userId, appId;
    let chartInstance;
    
    let activityListener = null;
    let journalListener = null;

    let activityCollection, journalCollection, ratingsCollection;
    let localActivities = []; 

    const todayString = new Date().toISOString().split('T')[0];

    // === 1. INISIALISASI FIREBASE ===

    // --- LANGKAH 1: PASTE KONFIGURASI FIREBASE ANDA DI SINI ---
    const firebaseConfig = {
      apiKey: "AIzaSyBZKgpQMPa4yrN7xej-oUfb6b2-geq73yQ",
      authDomain: "reflectify-app.firebaseapp.com",
      projectId: "reflectify-app",
      storageBucket: "reflectify-app.firebasestorage.app",
      messagingSenderId: "755819155107",
      appId: "1:755819155107:web:8054a48e71506cefbc3916",
      measurementId: "G-BX31TX62WB"
    };
    // --------------------------------------------------------

    async function initFirebase() {
      if (!firebaseConfig.apiKey || firebaseConfig.apiKey === "YOUR_API_KEY") {
        console.error("Firebase config belum diisi.");
        alert("Kesalahan Konfigurasi: Kunci Firebase belum diatur di file HTML.");
        return;
      }
      appId = firebaseConfig.projectId; 
      try {
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);
        console.log("Firebase Terinisialisasi.");

        onAuthStateChanged(auth, (user) => {
          if (user) {
            userId = user.uid;
            console.log("User terautentikasi:", userId);
            
            document.getElementById('app-page').style.display = 'flex';
            document.getElementById('auth-page').style.display = 'none';
            document.getElementById('mobile-nav').style.display = 'flex';
            
            document.getElementById('user-email').textContent = user.email || 'Anonymous';
            document.getElementById('user-email-mobile').textContent = user.email || 'Anonymous'; 
            document.getElementById('user-id').textContent = userId;

            defineCollectionPaths();
            loadAllData();

          } else {
            console.log("User tidak terautentikasi.");
            userId = null;
            
            document.getElementById('app-page').style.display = 'none';
            document.getElementById('auth-page').style.display = 'flex';
            document.getElementById('mobile-nav').style.display = 'none';

            if (activityListener) activityListener();
            if (journalListener) journalListener();
            
            clearUIOnLogout();
          }
        });

      } catch (e) {
        console.error("Error inisialisasi Firebase:", e);
      }
    }

    // === 2. FUNGSI AUTENTIKASI BARU ===
    
    function showAuthError(message) {
      const errorEl = document.getElementById('auth-error');
      errorEl.textContent = message;
      errorEl.style.display = 'block';
    }
    
    function clearAuthError() {
      document.getElementById('auth-error').style.display = 'none';
    }
    
    async function handleRegister() {
      clearAuthError();
      const email = document.getElementById('auth-email').value;
      const password = document.getElementById('auth-password').value;
      
      if (password.length < 6) {
        showAuthError("Password minimal harus 6 karakter.");
        return;
      }
      
      try {
        await createUserWithEmailAndPassword(auth, email, password);
      } catch (error) {
        console.error("Gagal register:", error.code);
        if (error.code === 'auth/email-already-in-use') {
          showAuthError("Email ini sudah terdaftar. Silakan login.");
        } else {
          showAuthError("Gagal mendaftar. Coba lagi.");
        }
      }
    }
    
    async function handleLogin() {
      clearAuthError();
      const email = document.getElementById('auth-email').value;
      const password = document.getElementById('auth-password').value;
      
      if (!email || !password) {
        showAuthError("Email dan password tidak boleh kosong.");
        return;
      }
      
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (error) {
        console.error("Gagal login:", error.code);
        if (error.code === 'auth/invalid-credential') {
          showAuthError("Email atau password salah.");
        } else {
          showAuthError("Gagal login. Coba lagi.");
        }
      }
    }
    
    async function handleLogout() {
      try {
        await signOut(auth);
      } catch (error) {
        console.error("Gagal logout:", error);
      }
    }
    
    function clearUIOnLogout() {
      document.getElementById('activity-list').innerHTML = '<p id="loading-activities" class="text-gray-500">Memuat aktivitas...</p>';
      document.getElementById('journal-list').innerHTML = '<p id="loading-journals" class="text-gray-500">Memuat jurnal...</p>';
      if (chartInstance) chartInstance.destroy();
      updateStarsUI('mood', 0);
      updateStarsUI('focus', 0);
      localActivities = [];
    }

    // === 3. MENENTUKAN PATH DATABASE ===
    function defineCollectionPaths() {
      if (!userId || !appId) return;
      const userPath = `users/${userId}`;

      activityCollection = collection(db, `${userPath}/activities`);
      journalCollection = collection(db, `${userPath}/journal_entries`);
      ratingsCollection = collection(db, `${userPath}/daily_ratings`);
    }

    // === 4. FUNGSI LOAD DATA ===
    async function loadAllData() {
      if (!userId) return;

      console.log("Mulai memuat semua data...");
      setupActivityListener();
      setupJournalListener(); 
      await loadDailyRatings();
    }
    
    function setupActivityListener() {
      const loadingEl = document.getElementById('loading-activities');
      loadingEl.textContent = "Memuat aktivitas...";
      
      const activitiesQuery = query(
        activityCollection, 
        where("date", "==", todayString),
        orderBy("createdAt", "desc") 
      );
      
      activityListener = onSnapshot(activitiesQuery, (snapshot) => {
        localActivities = []; 
        snapshot.forEach(doc => {
          localActivities.push({ id: doc.id, ...doc.data() }); 
        });
        
        if (snapshot.empty) {
          console.warn("DEBUG (Activities): Listener aktif, tapi tidak ada aktivitas hari ini.");
        } else {
          console.log("DEBUG (Activities): Listener aktif, data diterima:", localActivities);
        }
        
        renderActivityList(); 
        
      }, (error) => {
          console.error("FIREBASE ERROR (Activities):", error.message);
          loadingEl.innerHTML = `<span class="text-red-500">Error memuat aktivitas. (Cek Rules/Index)</span>`;
      });
    }

    function setupJournalListener() {
      document.getElementById('loading-journals').textContent = "Memuat jurnal...";

      const journalQuery = query(journalCollection, orderBy("createdAt", "desc"));

      journalListener = onSnapshot(journalQuery, (snapshot) => {
        const journalListEl = document.getElementById('journal-list');
        journalListEl.innerHTML = ''; 

        if (snapshot.empty) {
          journalListEl.innerHTML = '<p class="text-gray-500">Belum ada jurnal tersimpan.</p>';
          return;
        }

        snapshot.docs.forEach(doc => {
          const entry = doc.data();
          const docId = doc.id; 
          
          const entryEl = document.createElement('div');
          entryEl.className = "journal-item bg-gray-50 p-4 rounded-lg border border-gray-200"; 
          entryEl.dataset.docId = docId;
          entryEl.dataset.content = entry.content;
          entryEl.dataset.category = entry.category;
          
          entryEl.innerHTML = `
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm font-semibold bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full">${entry.category}</span>
              <span class="text-xs text-gray-400">${entry.createdAt.toDate().toLocaleDateString('id-ID')}</span>
            </div>
            <p class="text-gray-700">${entry.content.replace(/\n/g, '<br>')}</p>
          `;
          
          entryEl.addEventListener('click', () => {
            openEditModal('journal_entries', docId, entry.content, entry.category);
          });
          
          journalListEl.appendChild(entryEl); 
        });
      }, (error) => {
          console.error("FIREBASE ERROR (Journal):", error.message);
          document.getElementById('loading-journals').innerHTML = `<span class="text-red-500">Error memuat jurnal.</span>`;
      });
    }
    
    async function loadDailyRatings() {
      try {
        const todayRatingDoc = await getDoc(doc(ratingsCollection, todayString));
        if (todayRatingDoc.exists()) {
          const data = todayRatingDoc.data();
          updateStarsUI('mood', data.mood);
          updateStarsUI('focus', data.focus);
        } else {
          updateStarsUI('mood', 0);
          updateStarsUI('focus', 0);
        }
        await renderMoodFocusChart(); 
      } catch (error) {
        console.error("Error memuat rating:", error);
      }
    }

    // === 5. FUNGSI RENDER UI ===
    
    function renderActivityList() {
      const logListEl = document.getElementById('activity-list');
      const loadingEl = document.getElementById('loading-activities');
      
      logListEl.querySelectorAll('.activity-item').forEach(el => el.remove());
      
      if (localActivities.length === 0) {
        if (loadingEl) {
            loadingEl.textContent = "Belum ada aktivitas tercatat hari ini.";
            loadingEl.style.display = 'block';
        }
      } else {
        if (loadingEl) {
            loadingEl.style.display = 'none';
        }
        
        localActivities.forEach(activity => {
            const logEl = document.createElement('div');
            logEl.className = "activity-item flex items-center p-3 bg-green-50 rounded-lg border border-green-200"; 
            logEl.dataset.docId = activity.id;
            logEl.dataset.content = activity.name;
            
            logEl.innerHTML = `
              <ion-icon name="checkmark-circle" class="text-green-600 text-xl mr-3"></ion-icon>
              <span class="text-green-800 font-medium">${activity.name}</span>
            `;
            
            logEl.addEventListener('click', () => {
              openEditModal('activities', activity.id, activity.name);
            });
            
            logListEl.appendChild(logEl);
        });
      }
    }
    
    async function renderMoodFocusChart() {
      if (!ratingsCollection) return; 
      
      const ctx = document.getElementById('moodFocusChart').getContext('2d');
      
      const last7Days = getLast7Days(); 
      const labels = last7Days.map(d => d.label);
      const dateStrings = last7Days.map(d => d.dateString);

      const q = query(ratingsCollection, where("date", "in", dateStrings));
      
      let querySnapshot;
      try {
        querySnapshot = await getDocs(q);
      } catch (e) {
        console.error("Gagal mengambil data chart (Periksa Firestore Rules/Indexes):", e);
        return; 
      }
      
      const ratingsMap = new Map();
      querySnapshot.forEach(doc => {
        const data = doc.data();
        ratingsMap.set(data.date, data);
      });

      const moodData = [];
      const focusData = [];
      
      for (const dateString of dateStrings) {
        const rating = ratingsMap.get(dateString);
        if (rating) {
          moodData.push(rating.mood);
          focusData.push(rating.focus);
        } else {
          moodData.push(null); 
          focusData.push(null);
        }
      }

      if (chartInstance) {
        chartInstance.destroy();
      }

      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels, 
          datasets: [
            {
              label: 'Mood',
              data: moodData, 
              borderColor: 'rgb(79, 70, 229)',
              backgroundColor: 'rgba(79, 70, 229, 0.1)',
              tension: 0.3,
              fill: true,
              spanGaps: true, 
            },
            {
              label: 'Fokus',
              data: focusData, 
              borderColor: 'rgb(5, 150, 105)',
              backgroundColor: 'rgba(5, 150, 105, 0.1)',
              tension: 0.3,
              fill: true,
              spanGaps: true, 
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              max: 5,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    }
    
    function updateStarsUI(type, value) {
      const container = document.getElementById(`${type}-rating-stars`);
      if (!container) return;
      
      container.dataset.ratingValue = value; 

      container.querySelectorAll('ion-icon').forEach(star => {
        if (star.dataset.value <= value) {
          star.setAttribute('name', 'star');
          star.classList.add('text-yellow-400');
          star.classList.remove('text-gray-300');
        } else {
          star.setAttribute('name', 'star-outline');
          star.classList.remove('text-yellow-400');
          star.classList.add('text-gray-300');
        }
      });
    }


    // === 6. FUNGSI SIMPAN DATA (Write to DB) ===
    
    async function saveNewActivity() {
      const activityNameInput = document.getElementById('activity-name');
      const activityName = activityNameInput.value.trim();

      if (activityName && userId) {
        try {
          await addDoc(activityCollection, {
            name: activityName,
            date: todayString, 
            createdAt: Timestamp.now(),
            userId: userId
          });
          showToast("Aktivitas baru disimpan!");
          activityNameInput.value = '';
          toggleModal('add-activity-modal', false);
        } catch (e) {
          console.error("Gagal menyimpan aktivitas baru:", e);
          showToast("Gagal menyimpan. Cek console.");
        }
      }
    }
    
    async function saveJournalEntry() {
      const content = document.getElementById('journal-entry').value.trim();
      const category = document.getElementById('journal-category').value;

      if (content && category && userId) {
        try {
          await addDoc(journalCollection, {
            content: content,
            category: category,
            createdAt: Timestamp.now(),
            userId: userId
          });
          showToast("Jurnal disimpan!");
          document.getElementById('journal-entry').value = '';
        } catch (e) {
          console.error("Gagal menyimpan jurnal:", e);
          showToast("Gagal menyimpan. Cek console.");
        }
      }
    }
    
    async function saveDailyRating() {
      const moodValue = document.getElementById('mood-rating-stars').dataset.ratingValue;
      const focusValue = document.getElementById('focus-rating-stars').dataset.ratingValue;

      if (!moodValue || !focusValue || !userId) {
        console.warn("Harap pilih rating untuk Mood dan Fokus.");
        showToast("Harap pilih rating bintang 1-5");
        return;
      }

      const ratingData = {
        date: todayString,
        mood: parseInt(moodValue, 10),
        focus: parseInt(focusValue, 10),
        userId: userId
      };

      try {
        await setDoc(doc(ratingsCollection, todayString), ratingData);
        showToast("Rating harian disimpan!");
        await renderMoodFocusChart(); 
      } catch (e) {
        console.error("Gagal menyimpan rating:", e);
        showToast("Gagal menyimpan. Cek console.");
      }
    }
    
    async function handleSaveChanges() {
      const docId = document.getElementById('edit-doc-id').value;
      const collectionType = document.getElementById('edit-collection-type').value;
      
      if (!docId || !collectionType || !userId) return;
      
      let collectionRef;
      let dataToUpdate = {};
      
      if (collectionType === 'activities') {
        collectionRef = activityCollection;
        const newName = document.getElementById('edit-activity-name').value.trim();
        if (!newName) {
          showToast("Nama aktivitas tidak boleh kosong.");
          return;
        }
        dataToUpdate = { name: newName };
        
      } else if (collectionType === 'journal_entries') {
        collectionRef = journalCollection;
        const newContent = document.getElementById('edit-journal-content').value.trim();
        const newCategory = document.getElementById('edit-journal-category').value;
        if (!newContent) {
          showToast("Konten jurnal tidak boleh kosong.");
          return;
        }
        dataToUpdate = { content: newContent, category: newCategory };
      }
      
      const docRef = doc(collectionRef, docId);
      try {
        await updateDoc(docRef, dataToUpdate);
        showToast("Perubahan disimpan!");
        toggleModal('edit-modal', false);
      } catch (e) {
        console.error("Gagal update dokumen:", e);
        showToast("Gagal menyimpan. Cek console.");
      }
    }
    
    async function handleDeleteEntry() {
      const docId = document.getElementById('edit-doc-id').value;
      const collectionType = document.getElementById('edit-collection-type').value;
      
      if (!docId || !collectionType || !userId) return;
      
      let collectionRef;
      if (collectionType === 'activities') {
        collectionRef = activityCollection;
      } else if (collectionType === 'journal_entries') {
        collectionRef = journalCollection;
      } else {
        return;
      }
      
      const docRef = doc(collectionRef, docId);
      try {
        await deleteDoc(docRef);
        showToast("Entri berhasil dihapus.");
        toggleModal('edit-modal', false);
      } catch (e) {
        console.error("Gagal menghapus dokumen:", e);
        showToast("Gagal menghapus. Cek console.");
      }
    }

    // === 7. FUNGSI AI COMPANION (Gemini API) ===

    // --- LANGKAH 2: PASTE KUNCI API GEMINI ANDA DI SINI ---
    const GEMINI_API_KEY = "AIzaSyBxdF3ucub2VxeYSU0SeI6BhatffgRWQoU";
    // ----------------------------------------------------

    async function getAIBootcampResponse(prompt) {
      const systemPrompt = `
        Kamu adalah "Reflectify", seorang AI Companion yang bertindak sebagai guru batin mini.
        Tujuanmu adalah membantu pengguna memahami diri mereka dengan perspektif yang logis, empatik, dan filosofis (campuran Stoic, Psikologi Positif, dan Mindfulness).
        JANGAN menghakimi. JANGAN memberi nasihat medis.
        Tugasmu adalah:
        1.  Validasi perasaan mereka ("Wajar sekali kamu merasa begitu...").
        2.  Ajukan pertanyaan reflektif untuk membantu mereka melihat dari sudut pandang lain ("Apa yang kamu pelajari dari rasa marah itu?", "Jika kamu melihat situasi ini sebagai orang luar, apa yang akan kamu lihat?").
        3.  Berikan perspektif yang menenangkan dan logis.
        4.  Jaga jawaban tetap singkat, suportif, dan penuh empati.
      `;
      const apiKey = GEMINI_API_KEY;
      if (!apiKey || apiKey === "YOUR_GEMINI_API_KEY_HERE") {
        console.error("Kunci API Gemini belum diisi.");
        return "Maaf, Kunci API Gemini saya belum dikonfigurasi. Harap edit file HTML.";
      }
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
      const payload = {
        contents: [{
          parts: [{ text: prompt }]
        }],
        systemInstruction: {
          parts: [{ text: systemPrompt }]
        },
      };

      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!response.ok) {
          throw new Error(`API request failed with status ${response.status}`);
        }
        const result = await response.json();
        const candidate = result.candidates?.[0];
        if (candidate && candidate.content?.parts?.[0]?.text) {
          return candidate.content.parts[0].text;
        } else {
          return "Maaf, saya tidak yakin bagaimana harus merespons itu. Bisa coba lagi?";
        }
      } catch (error) {
        console.error("Error memanggil Gemini API:", error);
        return "Maaf, sepertinya saya sedang mengalami masalah koneksi. Coba beberapa saat lagi.";
      }
    }

    function addMessageToAIChat(message, isUser = false, isLoading = false) {
      const chatBox = document.getElementById('ai-chat-box');
      const messageDiv = document.createElement('div');
      messageDiv.className = `p-3 rounded-lg max-w-lg ${isUser ? 'bg-blue-100 text-blue-800 self-end' : 'bg-indigo-100 text-indigo-800 self-start'}`;

      if (isLoading) {
        messageDiv.innerHTML = `<p class="text-sm italic">${message}</p>`;
      } else {
        messageDiv.innerHTML = `<p class="text-sm">${message.replace(/\n/g, '<br>')}</p>`;
      }
      chatBox.appendChild(messageDiv);
      chatBox.scrollTop = chatBox.scrollHeight; 
      return messageDiv; 
    }

    async function handleAISend() {
      const input = document.getElementById('ai-input');
      const sendBtn = document.getElementById('ai-send-btn');
      const prompt = input.value.trim();
      if (!prompt) return;

      addMessageToAIChat(prompt, true); 
      input.value = ''; 

      const loadingEl = addMessageToAIChat("AI sedang berpikir...", false, true); 
      sendBtn.disabled = true; 
      input.disabled = true;

      const aiResponse = await getAIBootcampResponse(prompt);

      loadingEl.remove(); 
      addMessageToAIChat(aiResponse, false); 
      sendBtn.disabled = false; 
      input.disabled = false;
      input.focus();
    }


    // === 8. EVENT LISTENERS UTAMA (DIRUBAH) ===

    document.addEventListener('DOMContentLoaded', () => {
      initFirebase();
      initUI();
    });

    function initUI() {
      // Event Listener untuk Halaman Auth
      document.getElementById('login-btn').addEventListener('click', handleLogin);
      document.getElementById('register-btn').addEventListener('click', handleRegister);
      document.getElementById('logout-btn-desktop').addEventListener('click', handleLogout); 
      document.getElementById('logout-btn-mobile').addEventListener('click', handleLogout); 
    
      // Event Listener untuk UI baru
      document.getElementById('hamburger-btn').addEventListener('click', toggleSidebar);
      document.getElementById('profile-icon-btn').addEventListener('click', toggleProfileDropdown);
      
      // Tutup dropdown jika klik di luar
      document.addEventListener('click', (e) => {
        const dropdown = document.getElementById('profile-dropdown');
        const profileBtn = document.getElementById('profile-icon-btn');
        if (!dropdown.contains(e.target) && !profileBtn.contains(e.target) && !profileBtn.contains(e.target.parentElement)) {
          dropdown.style.display = 'none';
        }
      });
      
      // Navigasi Tab
      document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => showTab(button.dataset.tab));
      });

      // Modal Tambah Aktivitas
      document.getElementById('add-activity-btn').addEventListener('click', () => toggleModal('add-activity-modal', true));
      document.getElementById('cancel-add-activity').addEventListener('click', () => toggleModal('add-activity-modal', false));
      document.getElementById('save-new-activity').addEventListener('click', saveNewActivity);

      // Modal Edit
      document.getElementById('cancel-edit-btn').addEventListener('click', () => toggleModal('edit-modal', false));
      document.getElementById('save-changes-btn').addEventListener('click', handleSaveChanges);
      document.getElementById('delete-entry-btn').addEventListener('click', handleDeleteEntry);

      // Simpan Jurnal
      document.getElementById('save-journal-btn').addEventListener('click', saveJournalEntry);

      // Simpan Rating Harian
      setupStarRating('mood');
      setupStarRating('focus');
      document.getElementById('save-rating-btn').addEventListener('click', saveDailyRating);

      // Daily Prompt
      generateNewPrompt();
      document.getElementById('new-prompt-btn').addEventListener('click', generateNewPrompt);

      // AI Companion
      document.getElementById('ai-send-btn').addEventListener('click', handleAISend);
      document.getElementById('ai-input').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          handleAISend();
        }
      });
    }

    // === 9. FUNGSI HELPER LAINNYA ===

    // 9a. Navigasi Tab
    window.showTab = function (tabId) {
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active-tab'); 
        button.classList.remove('active-tab-mobile'); 
      });

      document.getElementById(tabId).classList.add('active');
      
      document.querySelectorAll(`.tab-button[data-tab="${tabId}"]`).forEach(button => {
        if (button.classList.contains('nav-sidebar')) {
          button.classList.add('active-tab');
        }
        if (button.classList.contains('nav-mobile')) {
          button.classList.add('active-tab-mobile');
        }
      });
    }

    // 9b. Toggle Modal
    window.toggleModal = function (modalId, show) {
      const modal = document.getElementById(modalId);
      if (show) {
        modal.style.display = 'flex';
      } else {
        modal.style.display = 'none';
      }
    }
    
    // (BARU) Toggle Sidebar Desktop
    function toggleSidebar() {
      document.getElementById('app-page').classList.toggle('sidebar-collapsed');
      // Tidak perlu lagi toggle desktop-footer karena sudah dihapus
    }
    
    // (BARU) Toggle Dropdown Profile Mobile
    function toggleProfileDropdown() {
      const dropdown = document.getElementById('profile-dropdown');
      if (dropdown.style.display === 'none') {
        dropdown.style.display = 'block';
      } else {
        dropdown.style.display = 'none';
      }
    }
    
    // 9c. Buka Modal Edit
    window.openEditModal = function (collectionType, docId, content, category = null) {
      document.getElementById('edit-doc-id').value = docId;
      document.getElementById('edit-collection-type').value = collectionType;
      
      const titleEl = document.getElementById('edit-modal-title');
      const activityForm = document.getElementById('edit-activity-form');
      const journalForm = document.getElementById('edit-journal-form');
      
      if (collectionType === 'activities') {
        titleEl.textContent = "Edit Aktivitas";
        activityForm.style.display = 'block'; 
        journalForm.style.display = 'none';  
        
        document.getElementById('edit-activity-name').value = content;
        
      } else if (collectionType === 'journal_entries') {
        titleEl.textContent = "Edit Jurnal";
        activityForm.style.display = 'none';   
        journalForm.style.display = 'block'; 
        
        document.getElementById('edit-journal-content').value = content;
        document.getElementById('edit-journal-category').value = category;
      }
      
      toggleModal('edit-modal', true); 
    }

    // 9d. Setup Rating Bintang
    function setupStarRating(type) {
      const container = document.getElementById(`${type}-rating-stars`);
      container.addEventListener('click', (e) => {
        if (e.target.tagName === 'ION-ICON') {
          const value = e.target.dataset.value;
          updateStarsUI(type, value);
        }
      });
    }

    // 9e. Daily Prompt
    const prompts = [
      "Apa hal kecil yang bisa kamu maafkan hari ini (baik pada diri sendiri atau orang lain)?",
      "Apakah kamu hari ini menilai atau mencoba memahami orang lain?",
      "Satu hal apa yang kamu syukuri hari ini, sekecil apapun itu?",
      "Apa satu hal yang kamu pelajari tentang dirimu sendiri hari ini?",
      "Kapan kamu merasa paling 'hadir' atau 'mindful' hari ini?",
      "Apa satu batasan (boundary) yang berhasil kamu jaga hari ini?",
      "Jika kamu bisa mengulang satu interaksi hari ini, apa yang akan kamu lakukan secara berbeda?",
    ];

    function generateNewPrompt() {
      const randomIndex = Math.floor(Math.random() * prompts.length);
      document.getElementById('prompt-question').textContent = prompts[randomIndex];
    }
    
    // 9f. Tampilkan Notifikasi Toast
    let toastTimeout;
    function showToast(message) {
      const toast = document.getElementById('toast-notification');
      if (!toast) return;
      
      toast.textContent = message;
      if (message.startsWith("Gagal") || message.startsWith("Error") || message.includes("salah")) {
          toast.classList.remove('bg-green-600');
          toast.classList.add('bg-red-600');
      } else {
          toast.classList.remove('bg-red-600');
          toast.classList.add('bg-green-600');
      }
      
      toast.classList.add('show'); 
      
      if (toastTimeout) {
        clearTimeout(toastTimeout);
      }
      
      toastTimeout = setTimeout(() => {
        toast.classList.remove('show'); 
      }, 3000); 
    }

    // 9g. Helper untuk mengambil 7 hari terakhir
    function getLast7Days() {
      const days = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
      const result = [];
      for (let i = 6; i >= 0; i--) { 
        const d = new Date();
        d.setDate(d.getDate() - i);
        result.push({
          label: days[d.getDay()], 
          dateString: d.toISOString().split('T')[0] 
        });
      }
      return result;
    }

  </script>

</body>

</html>

